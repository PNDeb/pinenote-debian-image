{{- $architecture := or .architecture "arm64" -}}
{{- $prevtargz := or .prevtargz "setupfirmware.tar.gz" }}
{{- $targz := or .targz "localdebs.tar.gz" }}

architecture: {{ $architecture }}

actions:
  - action: unpack
    file: {{ $prevtargz }}

  - action: overlay
    description: Copy local deb packages to /root
    source: overlays/local-debs/
    destination: /root/

  - action: run
    description: Install all the local deb packages
    chroot: true
    command: dpkg -i /root/*.deb

  - action: run
    description: Clean up root's deb files
    chroot: true
    command: rm /root/*.deb

  - action: pack
    file: {{ $targz }}

