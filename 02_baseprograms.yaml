{{- $architecture := or .architecture "arm64" -}}
{{- $prevtargz := .prevtargz }}
{{- $targz := .targz }}

architecture: {{ $architecture }}

actions:
  - action: unpack
    file: {{ $prevtargz }}

  - action: apt
    recommends: false
    update: true
    description: Install aptitude
    packages:
      - aptitude

  - action: run
    description: sda
    chroot: true
    command: |
      aptitude versions gnome-shell

  - action: run
    description: sda
    chroot: true
    command: |
      aptitude versions gnome-session

  - action: apt
    recommends: false
    update: true
    description: Install GNOME (tests)
    packages:
      - gnome-session
      - gdm3
      - gnome

  - action: run
    description: apt fix install
    chroot: true
    command: apt -y --fix-broken install

  - action: apt
    recommends: false
    update: true
    description: Install base programs
    packages:
      - sudo
      - ca-certificates
      - man-db
      - console-setup
      - console-data
      - parted
      - file
      - usbutils
      - bash-completion
      - bzip2
      - xz-utils
      - vim-nox
      - w3m
      - mc
      - bluetooth
      - iw
      - network-manager
      - wget
      - rfkill
      - wireless-regdb
      - wireless-tools
      - wpasupplicant
      - ssh
      - alsa-utils
      - busybox
      - u-boot-menu
      - zstd
      - firmware-brcm80211
      - bluez-firmware
      - tree
      - htop
      - rsync
      - locales
      - unzip
      - screen
      - evtest
      - systemd-resolved
      - ntp
      - speech-dispatcher-espeak-ng
      - espeak-ng
      - silversearcher-ag
      - stress
      - dialog
      - locales

  - action: pack
    file: {{ $targz }}
